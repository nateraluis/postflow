{% extends "analytics/shared/post_detail.html" %}
{% load analytics_filters %}

{% block engagement_details %}
<!-- Engagement Details Tabs -->
<div class="bg-white shadow rounded-lg overflow-hidden">
  <div class="border-b border-gray-200">
    <nav class="-mb-px flex" aria-label="Tabs">
      <button onclick="showTab('likes')" id="tab-likes" class="tab-button w-1/3 py-3 sm:py-4 px-1 text-center border-b-2 border-gray-900 font-medium text-xs sm:text-sm text-gray-900">
        <span class="hidden sm:inline">Likes ({{ likes|length }})</span>
        <span class="sm:hidden">Likes<br>({{ likes|length }})</span>
      </button>
      <button onclick="showTab('comments')" id="tab-comments" class="tab-button w-1/3 py-3 sm:py-4 px-1 text-center border-b-2 border-transparent font-medium text-xs sm:text-sm text-gray-500 hover:text-gray-700 hover:border-gray-300">
        <span class="hidden sm:inline">Comments ({{ comments|length }})</span>
        <span class="sm:hidden">Comments<br>({{ comments|length }})</span>
      </button>
      <button onclick="showTab('shares')" id="tab-shares" class="tab-button w-1/3 py-3 sm:py-4 px-1 text-center border-b-2 border-transparent font-medium text-xs sm:text-sm text-gray-500 hover:text-gray-700 hover:border-gray-300">
        <span class="hidden sm:inline">Shares ({{ shares|length }})</span>
        <span class="sm:hidden">Shares<br>({{ shares|length }})</span>
      </button>
    </nav>
  </div>

  <!-- Likes Tab -->
  <div id="content-likes" class="tab-content p-3 sm:p-6">
    {% if likes %}
    <div class="space-y-3 sm:space-y-4">
      {% for like in likes %}
      <div class="flex items-center justify-between py-2 border-b border-gray-100 gap-2">
        <div class="flex items-center min-w-0 flex-1">
          {% include 'analytics/shared/components/icons.html#heart-icon' with size='h-4 w-4 sm:h-5 sm:w-5' color='gray-500' %}
          <span class="ml-2 text-xs sm:text-sm font-medium text-gray-900 truncate">{{ like.username }}</span>
        </div>
        <span class="text-xs text-gray-500 whitespace-nowrap">{{ like.liked_at|date:"M d, Y H:i" }}</span>
      </div>
      {% endfor %}
    </div>
    {% else %}
    <p class="text-xs sm:text-sm text-gray-500 text-center py-6 sm:py-8">No likes yet</p>
    {% endif %}
  </div>

  <!-- Comments Tab -->
  <div id="content-comments" class="tab-content p-3 sm:p-6 hidden">
    {% if comments %}
    <div class="space-y-3 sm:space-y-4">
      {% for comment in comments %}
      <div class="border-b border-gray-100 pb-3 sm:pb-4">
        <div class="flex flex-col sm:flex-row sm:items-start sm:justify-between gap-1 sm:gap-2 mb-2">
          <span class="text-xs sm:text-sm font-medium text-gray-900 truncate">{{ comment.username }}</span>
          <span class="text-xs text-gray-500 whitespace-nowrap">{{ comment.commented_at|date:"M d, Y H:i" }}</span>
        </div>
        <p class="text-xs sm:text-sm text-gray-600 break-words">{{ comment.content_text }}</p>
      </div>
      {% endfor %}
    </div>
    {% else %}
    <p class="text-xs sm:text-sm text-gray-500 text-center py-6 sm:py-8">No comments yet</p>
    {% endif %}
  </div>

  <!-- Shares Tab -->
  <div id="content-shares" class="tab-content p-3 sm:p-6 hidden">
    {% if shares %}
    <div class="space-y-3 sm:space-y-4">
      {% for share in shares %}
      <div class="flex items-center justify-between py-2 border-b border-gray-100 gap-2">
        <div class="flex items-center min-w-0 flex-1">
          {% include 'analytics/shared/components/icons.html#share-icon' with size='h-4 w-4 sm:h-5 sm:w-5' color='gray-500' %}
          <span class="ml-2 text-xs sm:text-sm font-medium text-gray-900 truncate">{{ share.username }}</span>
        </div>
        <span class="text-xs text-gray-500 whitespace-nowrap">{{ share.shared_at|date:"M d, Y H:i" }}</span>
      </div>
      {% endfor %}
    </div>
    {% else %}
    <p class="text-xs sm:text-sm text-gray-500 text-center py-6 sm:py-8">No shares yet</p>
    {% endif %}
  </div>
</div>
{% endblock %}

{% block extra_scripts %}
<script>
function showTab(tabName) {
  // Hide all tab contents
  const contents = document.querySelectorAll('.tab-content');
  contents.forEach(content => content.classList.add('hidden'));

  // Remove active state from all tabs
  const tabs = document.querySelectorAll('.tab-button');
  tabs.forEach(tab => {
    tab.classList.remove('border-gray-900', 'text-gray-900');
    tab.classList.add('border-transparent', 'text-gray-500');
  });

  // Show selected tab content
  document.getElementById('content-' + tabName).classList.remove('hidden');

  // Activate selected tab
  const activeTab = document.getElementById('tab-' + tabName);
  activeTab.classList.remove('border-transparent', 'text-gray-500');
  activeTab.classList.add('border-gray-900', 'text-gray-900');
}
</script>
{% endblock %}
