{% extends "analytics/shared/post_detail.html" %}
{% load analytics_filters %}

{% block engagement_details %}
<!-- Engagement Details Tabs -->
<div class="bg-white shadow rounded-lg overflow-hidden">
  <div class="border-b border-gray-200">
    <nav class="-mb-px flex" aria-label="Tabs">
      <button onclick="showTab('favourites')" id="tab-favourites" class="tab-button w-1/3 py-4 px-1 text-center border-b-2 border-gray-900 font-medium text-sm text-gray-900">
        Favourites ({{ favourites|length }})
      </button>
      <button onclick="showTab('replies')" id="tab-replies" class="tab-button w-1/3 py-4 px-1 text-center border-b-2 border-transparent font-medium text-sm text-gray-500 hover:text-gray-700 hover:border-gray-300">
        Replies ({{ replies|length }})
      </button>
      <button onclick="showTab('reblogs')" id="tab-reblogs" class="tab-button w-1/3 py-4 px-1 text-center border-b-2 border-transparent font-medium text-sm text-gray-500 hover:text-gray-700 hover:border-gray-300">
        Reblogs ({{ reblogs|length }})
      </button>
    </nav>
  </div>

  <!-- Favourites Tab -->
  <div id="content-favourites" class="tab-content p-6">
    {% if favourites %}
    <div class="space-y-4">
      {% for favourite in favourites %}
      <div class="flex items-center justify-between py-2 border-b border-gray-100">
        <div class="flex items-center">
          {% include 'analytics/shared/components/icons.html#heart-icon' with size='h-5 w-5' color='gray-500' %}
          <span class="ml-2 text-sm font-medium text-gray-900">{{ favourite.username }}</span>
        </div>
        <span class="text-xs text-gray-500">{{ favourite.favourited_at|date:"M d, Y H:i" }}</span>
      </div>
      {% endfor %}
    </div>
    {% else %}
    <p class="text-gray-500 text-center py-8">No favourites yet</p>
    {% endif %}
  </div>

  <!-- Replies Tab -->
  <div id="content-replies" class="tab-content p-6 hidden">
    {% if replies %}
    <div class="space-y-4">
      {% for reply in replies %}
      <div class="border-b border-gray-100 pb-4">
        <div class="flex items-start justify-between mb-2">
          <span class="text-sm font-medium text-gray-900">{{ reply.username }}</span>
          <span class="text-xs text-gray-500">{{ reply.replied_at|date:"M d, Y H:i" }}</span>
        </div>
        <p class="text-sm text-gray-600">{{ reply.content_text }}</p>
      </div>
      {% endfor %}
    </div>
    {% else %}
    <p class="text-gray-500 text-center py-8">No replies yet</p>
    {% endif %}
  </div>

  <!-- Reblogs Tab -->
  <div id="content-reblogs" class="tab-content p-6 hidden">
    {% if reblogs %}
    <div class="space-y-4">
      {% for reblog in reblogs %}
      <div class="flex items-center justify-between py-2 border-b border-gray-100">
        <div class="flex items-center">
          {% include 'analytics/shared/components/icons.html#share-icon' with size='h-5 w-5' color='gray-500' %}
          <span class="ml-2 text-sm font-medium text-gray-900">{{ reblog.username }}</span>
        </div>
        <span class="text-xs text-gray-500">{{ reblog.reblogged_at|date:"M d, Y H:i" }}</span>
      </div>
      {% endfor %}
    </div>
    {% else %}
    <p class="text-gray-500 text-center py-8">No reblogs yet</p>
    {% endif %}
  </div>
</div>
{% endblock %}

{% block extra_scripts %}
<script>
function showTab(tabName) {
  // Hide all tab contents
  const contents = document.querySelectorAll('.tab-content');
  contents.forEach(content => content.classList.add('hidden'));

  // Remove active state from all tabs
  const tabs = document.querySelectorAll('.tab-button');
  tabs.forEach(tab => {
    tab.classList.remove('border-gray-900', 'text-gray-900');
    tab.classList.add('border-transparent', 'text-gray-500');
  });

  // Show selected tab content
  document.getElementById('content-' + tabName).classList.remove('hidden');

  // Activate selected tab
  const activeTab = document.getElementById('tab-' + tabName);
  activeTab.classList.remove('border-transparent', 'text-gray-500');
  activeTab.classList.add('border-gray-900', 'text-gray-900');
}
</script>
{% endblock %}
