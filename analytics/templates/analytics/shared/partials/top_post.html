{% load analytics_filters %}
{% comment %}
Top performing post showcase component
Requires context: top_post, platform
{% endcomment %}

{% if top_post %}
<div class="bg-white shadow rounded-lg overflow-hidden h-full flex flex-col">
  <!-- Header -->
  <div class="p-4 sm:p-6 border-b border-gray-200">
    <div class="flex items-center justify-between">
      <div>
        <h2 class="text-lg font-semibold text-gray-900">Top Performing Post</h2>
        <p class="text-sm text-gray-500">Your highest engagement content</p>
      </div>
      <a href="{% build_url platform.url_namespace 'post_detail' top_post.id %}"
         class="text-sm font-medium text-violet-600 hover:text-violet-700 inline-flex items-center whitespace-nowrap">
        View more details
        <svg class="ml-1 h-4 w-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7"/>
        </svg>
      </a>
    </div>
  </div>

  <!-- Image -->
  <a href="{% build_url platform.url_namespace 'post_detail' top_post.id %}" class="block">
    {% with display_url=top_post.get_display_image_url %}
    {% if display_url %}
    <img src="{{ display_url }}"
         alt="Top post"
         class="w-full h-auto object-contain bg-gray-50">
    {% elif top_post.media_url %}
    <img src="{{ top_post.media_url }}"
         alt="Top post"
         class="w-full h-auto object-contain bg-gray-50">
    {% else %}
    <div class="w-full h-48 sm:h-64 bg-gray-200 flex items-center justify-center">
      {% include 'analytics/shared/components/icons.html#image-icon' with size='h-12 w-12 sm:h-16 sm:w-16' color='gray-400' %}
    </div>
    {% endif %}
    {% endwith %}
  </a>

  <!-- Content -->
  <div class="p-4 sm:p-6 flex-1 flex flex-col">
    <!-- Metadata -->
    <p class="text-xs sm:text-sm text-gray-600 mb-2">
      @{{ top_post|get_username_field:platform.slug }} â€¢ {{ top_post.posted_at|date:"M d, Y" }}
    </p>

    <!-- Caption -->
    {% with content=top_post|get_content_field:platform.slug %}
    {% if content %}
    <p class="text-xs sm:text-sm text-gray-700 line-clamp-2 mb-3">{{ content|truncatewords:20 }}</p>
    {% endif %}
    {% endwith %}

    <!-- Metrics -->
    {% if top_post.engagement_summary %}
    <div class="flex items-center gap-2 sm:gap-4 text-xs sm:text-sm text-gray-500 flex-wrap mt-auto">
      {% for metric in platform.metrics %}
      <div class="flex items-center gap-1">
        {% if metric.icon == 'heart' %}
          {% include 'analytics/shared/components/icons.html#heart-icon' with size='h-3 w-3 sm:h-4 sm:w-4' color='gray-400' %}
        {% elif metric.icon == 'comment' %}
          {% include 'analytics/shared/components/icons.html#comment-icon' with size='h-3 w-3 sm:h-4 sm:w-4' color='gray-400' %}
        {% elif metric.icon == 'share' %}
          {% include 'analytics/shared/components/icons.html#share-icon' with size='h-3 w-3 sm:h-4 sm:w-4' color='gray-400' %}
        {% elif metric.icon == 'bookmark' %}
          {% include 'analytics/shared/components/icons.html#bookmark-icon' with size='h-3 w-3 sm:h-4 sm:w-4' color='gray-400' %}
        {% elif metric.icon == 'people' %}
          {% include 'analytics/shared/components/icons.html#people-icon' with size='h-3 w-3 sm:h-4 sm:w-4' color='gray-400' %}
        {% endif %}
        <span>{{ top_post|get_metric:metric.key }}</span>
      </div>
      {% endfor %}
    </div>
    {% endif %}
  </div>
</div>
{% endif %}
