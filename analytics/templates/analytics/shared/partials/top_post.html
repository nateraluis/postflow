{% load analytics_filters %}
{% comment %}
Top performing post showcase component
Requires context: top_post, platform
{% endcomment %}

{% if top_post %}
<div class="mb-6 sm:mb-8">
  <h2 class="text-base sm:text-lg font-semibold text-gray-900 mb-3 sm:mb-4">Top Performing Post</h2>
  <div class="bg-gradient-to-r from-gray-50 to-gray-100 border border-gray-200 shadow rounded-lg overflow-hidden">
    <div class="p-4 sm:p-6">
      <div class="flex flex-col sm:flex-row sm:items-start gap-4 sm:gap-6">
        <!-- Thumbnail -->
        <div class="flex-shrink-0 w-full sm:w-auto">
          <a href="{% build_url platform.url_namespace 'post_detail' top_post.id %}" class="block">
            {% with display_url=top_post.get_display_image_url %}
            {% if display_url %}
            <img src="{{ display_url }}"
                 alt="Post thumbnail"
                 class="w-full sm:w-32 h-48 sm:h-32 object-cover rounded-lg shadow-md hover:shadow-lg transition-shadow">
            {% elif top_post.media_url %}
            <img src="{{ top_post.media_url }}"
                 alt="Post thumbnail"
                 class="w-full sm:w-32 h-48 sm:h-32 object-cover rounded-lg shadow-md hover:shadow-lg transition-shadow">
            {% else %}
            <div class="w-full sm:w-32 h-48 sm:h-32 bg-gray-300 rounded-lg flex items-center justify-center">
              {% include 'analytics/shared/components/icons.html#image-icon' with size='h-12 w-12' color='gray-500' %}
            </div>
            {% endif %}
            {% endwith %}
          </a>
        </div>

        <!-- Post Info -->
        <div class="flex-1 min-w-0">
          <div class="flex flex-col sm:flex-row sm:items-center sm:justify-between gap-2 mb-2">
            <h3 class="text-base sm:text-lg font-bold text-gray-900">Top Performing Post</h3>
            {% if top_post.post_url %}
            <a href="{{ top_post.post_url }}"
               target="_blank"
               rel="noopener noreferrer"
               class="text-gray-700 hover:text-gray-900 text-xs sm:text-sm font-medium whitespace-nowrap">
              View on {{ platform.name }} →
            </a>
            {% elif top_post.permalink %}
            <a href="{{ top_post.permalink }}"
               target="_blank"
               rel="noopener noreferrer"
               class="text-gray-700 hover:text-gray-900 text-xs sm:text-sm font-medium whitespace-nowrap">
              View on {{ platform.name }} →
            </a>
            {% endif %}
          </div>

          <p class="text-xs sm:text-sm text-gray-600 mb-2 sm:mb-3">
            @{{ top_post|get_username_field:platform.slug }} • {{ top_post.posted_at|date:"M d, Y" }}
          </p>

          {% with content=top_post|get_content_field:platform.slug %}
          {% if content %}
          <p class="text-xs sm:text-sm text-gray-700 line-clamp-2 mb-3 sm:mb-4">{{ content }}</p>
          {% endif %}
          {% endwith %}

          <!-- Quick Stats -->
          {% if top_post.engagement_summary %}
          <div class="flex items-center gap-3 sm:gap-6 flex-wrap">
            {% for metric in platform.metrics %}
            <div class="flex items-center gap-1">
              {% if metric.icon == 'heart' %}
                {% include 'analytics/shared/components/icons.html#heart-icon' with size='h-4 w-4 sm:h-5 sm:w-5' color='gray-500' %}
              {% elif metric.icon == 'comment' %}
                {% include 'analytics/shared/components/icons.html#comment-icon' with size='h-4 w-4 sm:h-5 sm:w-5' color='gray-500' %}
              {% elif metric.icon == 'share' %}
                {% include 'analytics/shared/components/icons.html#share-icon' with size='h-4 w-4 sm:h-5 sm:w-5' color='gray-500' %}
              {% elif metric.icon == 'bookmark' %}
                {% include 'analytics/shared/components/icons.html#bookmark-icon' with size='h-4 w-4 sm:h-5 sm:w-5' color='gray-500' %}
              {% elif metric.icon == 'people' %}
                {% include 'analytics/shared/components/icons.html#people-icon' with size='h-4 w-4 sm:h-5 sm:w-5' color='gray-500' %}
              {% endif %}
              <span class="text-xs sm:text-sm font-semibold text-gray-900">{{ top_post|get_metric:metric.key }}</span>
              <span class="text-xs text-gray-500 hidden sm:inline">{{ metric.label|lower }}</span>
            </div>
            {% endfor %}
            <div class="flex items-center gap-1">
              <span class="text-xs sm:text-sm font-bold text-gray-900">{{ top_post.engagement_summary.total_engagement|default:0 }}</span>
              <span class="text-xs text-gray-500">total</span>
            </div>
          </div>
          {% endif %}
        </div>
      </div>
    </div>
  </div>
</div>
{% endif %}
